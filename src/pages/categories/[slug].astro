---
import { collectSiteCategoryMap } from "@lib/TaxonomyHelpers";

import { getCollection } from "astro:content";
import PageLayout from "@layouts/PageLayout.astro";
import PostListing from "@components/PostListing.astro";

type Post = {
    data: {
        title: string;
        date: Date;
        categories: string[];
    };
    id: string;
};

export async function getStaticPaths() {
  const slugs = await collectSiteCategoryMap();
  console.log(slugs.keys());

  return Array.from(slugs.keys()).map((slug) => ({
      params: { slug },
      props: { slug, posts: slugs.get(slug) },
  }));
}

const { slug, posts } = Astro.props;
---

<PageLayout title={slug}>
    <PostListing posts={posts} />
</PageLayout>
