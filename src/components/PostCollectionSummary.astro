---
import CategoryCount from "@components/CategoryCount.astro"
import type { PostInterface } from "@lib/Post"

interface Props {
    href: string
    text: string
    posts: PostInterface[] | undefined;
}

function groupPostsByCategories(posts: PostInterface[]): Map<string, PostInterface[]> {
    const categories = new Map<string, PostInterface[]>()
    posts.forEach((post) => {
      for (const category of post.data.categories) {
        if (!categories.has(category)) {
            categories.set(category, [])
        }
        categories.get(category)?.push(post)
      }
    })
    return categories
}

const knownCategories = ["note", "gallery", "post", ]
const { href, text, posts } = Astro.props as Props
const categories = groupPostsByCategories(posts || [])
---
<div>
  <a {href}>{text}</a>
    {knownCategories.map((category) => <CategoryCount {category} count={categories.get(category)?.length || 0} />)}
</div>

<style type="text/scss">
  div {
    background-color: var(--rg-color-accent);
    padding: 0.5rem;
    border-radius: var(--rg-border-radius);
    border: thin solid var(--rg-color-line);
    display: flex;
    justify-content: space-between;
  }
  a {
      flex-grow: 2;
  }
</style>
